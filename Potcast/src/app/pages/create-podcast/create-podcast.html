<div class="min-h-screen bg-[#0d111b] text-white font-sans">
  <div class="max-w-[1200px] mx-auto px-4 md:px-8 py-8 md:py-12">
    <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between mb-8">
      <div class="flex flex-col gap-2">
        <div class="flex items-center gap-2 text-[#9da6b9] text-sm cursor-pointer">
          <span class="material-symbols-outlined text-[16px]">home</span>
          <span (click)="goHome()" class="hover:text-white transition">Home</span>
          <span>/</span>
          <span (click)="goHome()" class="hover:text-white transition">Podcasts</span>
          <span>/</span>
          <span class="text-white">Crear</span>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Crear nuevo podcast</h1>
        <p class="text-[#9da6b9] text-sm md:text-base max-w-2xl">
          Completa los campos esenciales y revisa la vista previa antes de publicar.
        </p>
      </div>
      <button
        (click)="goHome()"
        class="text-[#9da6b9] hover:text-white transition-colors text-sm flex items-center gap-1"
      >
        <span class="material-symbols-outlined text-[16px]">arrow_back</span>
        Volver a Home
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <form
        #podcastForm="ngForm"
        (ngSubmit)="onSubmit()"
        class="lg:col-span-8 bg-[#141a26] border border-[#232a36] rounded-2xl p-6 md:p-8 shadow-xl flex flex-col gap-8"
      >
        <div class="flex flex-wrap gap-2">
          <span
            class="bg-primary/20 text-primary text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full"
            >Detalles</span
          >
          <span
            class="bg-[#1c2230] text-[#9da6b9] text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full"
            >Host</span
          >
        </div>

        <fieldset class="flex flex-col gap-5">
          <legend class="text-primary font-bold uppercase text-xs tracking-wider mb-2">
            Información del Episodio
          </legend>

          <div>
            <label for="temaDia" class="block text-sm text-[#cbd5e1] mb-1">
              Título del episodio <span class="text-red-400 font-bold">*</span>
            </label>
            <input
              id="temaDia"
              [(ngModel)]="newPodcast.temaDia"
              name="temaDia"
              type="text"
              required
              #temaDiaModel="ngModel"
              placeholder="Ej: El futuro de la IA"
              class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white placeholder:text-[#6b7280] focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
            />
            <p class="text-xs text-[#9da6b9] mt-1">Claro y directo. Evita más de 60 caracteres.</p>
            <p
              *ngIf="
                temaDiaModel.invalid &&
                (temaDiaModel.touched || podcastForm.submitted) &&
                !submitSuccess
              "
              class="text-xs text-red-400 mt-1"
            >
              El título es obligatorio.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="temaGeneral" class="block text-sm text-[#cbd5e1] mb-1"
                >Tema general</label
              >
              <input
                id="temaGeneral"
                [(ngModel)]="newPodcast.temaGeneral"
                name="temaGeneral"
                type="text"
                placeholder="Ej: Tendencias Tecnológicas"
                class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white placeholder:text-[#6b7280] focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
              />
            </div>
            <div>
              <label for="categoria" class="block text-sm text-[#cbd5e1] mb-1">Categoría</label>
              <select
                id="categoria"
                [(ngModel)]="newPodcast.categoria"
                name="categoria"
                class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
              >
                <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="fecha" class="block text-sm text-[#cbd5e1] mb-1">Fecha</label>
              <input
                id="fecha"
                [(ngModel)]="newPodcast.fecha"
                name="fecha"
                type="date"
                class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
              />
            </div>
            <div>
              <label for="audioUrl" class="block text-sm text-[#cbd5e1] mb-1">
                URL del audio (MP3) <span class="text-red-400 font-bold">*</span>
              </label>
              <input
                id="audioUrl"
                [(ngModel)]="newPodcast.audioUrl"
                name="audioUrl"
                type="url"
                required
                #audioUrlModel="ngModel"
                placeholder="https://..."
                class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white placeholder:text-[#6b7280] focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
              />
              <p
                *ngIf="
                  audioUrlModel.invalid &&
                  (audioUrlModel.touched || podcastForm.submitted) &&
                  !submitSuccess
                "
                class="text-xs text-red-400 mt-1"
              >
                La URL del audio es obligatoria.
              </p>
            </div>
          </div>
        </fieldset>

        <fieldset class="flex flex-col gap-5">
          <legend class="text-primary font-bold uppercase text-xs tracking-wider mb-2">
            Locutor Principal
          </legend>

          <div class="flex gap-2">
            <button type="button"
                    (click)="locutorMode = 'existing'; setLocutorFromSelection()"
                    [class.bg-primary]="locutorMode === 'existing'"
                    class="px-3 py-2 rounded-lg text-sm border border-[#232a36]">
              Usar locutor creado
            </button>
            <button type="button"
                    (click)="locutorMode = 'manual'; setManualLocutor()"
                    [class.bg-primary]="locutorMode === 'manual'"
                    class="px-3 py-2 rounded-lg text-sm border border-[#232a36]">
              Escribir nombre
            </button>
          </div>

          <div *ngIf="locutorMode === 'existing'">
            <label for="locutorSelect" class="block text-sm text-[#cbd5e1] mb-1">
              Selecciona un locutor <span class="text-red-400 font-bold">*</span>
            </label>
            <select
              id="locutorSelect"
              [(ngModel)]="selectedLocutorId"
              (change)="setLocutorFromSelection()"
              name="locutorSelect"
              required
              #locutorSelectModel="ngModel"
              class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
            >
              <option value="">Selecciona un locutor</option>
              <option *ngFor="let l of locutores" [value]="l.id">{{ l.nickname }}</option>
            </select>
            <p
              *ngIf="
                locutorSelectModel.invalid &&
                (locutorSelectModel.touched || podcastForm.submitted) &&
                !submitSuccess
              "
              class="text-xs text-red-400 mt-1"
            >
              El locutor es obligatorio.
            </p>
            <p class="text-xs text-[#9da6b9] mt-1" *ngIf="locutores.length === 0">
              No hay locutores creados. Crea uno en la sección de Presentadores.
            </p>
          </div>

          <div *ngIf="locutorMode === 'manual'">
            <label for="locutorManual" class="block text-sm text-[#cbd5e1] mb-1">
              Nombre del locutor <span class="text-red-400 font-bold">*</span>
            </label>
            <input
              id="locutorManual"
              [(ngModel)]="manualLocutorName"
              (ngModelChange)="setManualLocutor()"
              name="locutorManual"
              type="text"
              required
              #locutorManualModel="ngModel"
              placeholder="Ej: Juan Pérez"
              class="w-full bg-[#0f141f] border border-[#232a36] rounded-xl px-4 py-3 text-white placeholder:text-[#6b7280] focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition"
            />
            <p
              *ngIf="
                locutorManualModel.invalid &&
                (locutorManualModel.touched || podcastForm.submitted) &&
                !submitSuccess
              "
              class="text-xs text-red-400 mt-1"
            >
              El nombre del locutor es obligatorio.
            </p>
          </div>
        </fieldset>

        <div
          *ngIf="submitSuccess"
          class="rounded-xl border border-emerald-500/50 bg-emerald-500/20 text-emerald-200 text-sm px-4 py-4 flex items-start gap-3 animate-pulse"
        >
          <span class="material-symbols-outlined text-emerald-300 text-[24px] shrink-0"
            >check_circle</span
          >
          <div class="flex flex-col gap-2">
            <p class="font-bold text-base">✓ Podcast creado exitosamente</p>
            <p class="text-emerald-200/90">
              Tu episodio fue guardado correctamente. Redirigiendo al dashboard...
            </p>
          </div>
        </div>

        <div
          *ngIf="submitError"
          class="rounded-xl border border-red-500/30 bg-red-500/10 text-red-300 text-sm px-4 py-3"
        >
          {{ submitError }}
        </div>

        <div
          *ngIf="podcastForm.submitted && podcastForm.invalid && !submitSuccess"
          class="rounded-xl border border-red-500/30 bg-red-500/10 text-red-300 text-sm px-4 py-3"
        >
          Revisa los campos obligatorios antes de continuar.
        </div>

        <div
          class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between pt-2 border-t border-[#232a36]"
        >
          <p class="text-xs text-[#9da6b9]">
            Los campos con <span class="text-red-400 font-bold">*</span> son obligatorios.
          </p>
          <button
            type="submit"
            class="bg-primary hover:bg-primary/90 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-primary/20 transition-all hover:translate-y-[-1px] active:translate-y-[1px]"
            [disabled]="podcastForm.invalid || isSubmitting || submitSuccess"
          >
            {{ isSubmitting ? 'Creando...' : 'Crear podcast' }}
          </button>
        </div>
      </form>

      <aside class="lg:col-span-4 flex flex-col gap-6">
        <div class="bg-[#141a26] border border-[#232a36] rounded-2xl p-6">
          <h3 class="text-lg font-bold mb-3">Vista previa</h3>
          <div class="flex gap-4 items-center">
            <div
              class="size-16 rounded-xl bg-slate-700 bg-cover bg-center flex items-center justify-center"
              [style.background-image]="
                newPodcast.locutorPrincipal?.fotografiaUrl
                  ? 'url(' + newPodcast.locutorPrincipal.fotografiaUrl + ')'
                  : 'none'
              "
            >
              <span
                *ngIf="!newPodcast.locutorPrincipal?.fotografiaUrl"
                class="material-symbols-outlined text-white/80 text-[32px]"
                >mic</span
              >
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-white font-semibold truncate">
                {{ newPodcast.temaDia || 'Título del episodio' }}
              </p>
              <p class="text-[#9da6b9] text-sm truncate">
                {{ newPodcast.locutorPrincipal?.nickname || 'Nombre del host' }}
              </p>
              <p class="text-[#9da6b9] text-xs">{{ newPodcast.fecha || 'Fecha' }}</p>
            </div>
          </div>
          <div class="mt-4 text-xs text-[#9da6b9]">
            Categoría:
            <span class="text-white font-semibold">{{
              newPodcast.categoria || 'Sin categoría'
            }}</span>
          </div>
        </div>

        <div class="bg-[#141a26] border border-[#232a36] rounded-2xl p-6">
          <h3 class="text-lg font-bold mb-3">Tips rápidos</h3>
          <ul class="text-sm text-[#cbd5e1] space-y-2">
            <li>• Usa un título concreto y memorable.</li>
            <li>• La imagen del host mejora la confianza del usuario.</li>
            <li>• Mantén consistencia en tema y categoría.</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>
</div>
